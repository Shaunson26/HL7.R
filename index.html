<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Import and export of HL7 2.3.1/2.4 messages. HL7 is broad, so NCIMS (in-house system) related specs are covered first.">
<title>HL7 Wrangling In R • HL7.R</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="HL7 Wrangling In R">
<meta property="og:description" content="Import and export of HL7 2.3.1/2.4 messages. HL7 is broad, so NCIMS (in-house system) related specs are covered first.">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">HL7.R</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2023.01.10</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="articles/Getting-started.html">Getting-started</a>
    <a class="dropdown-item" href="articles/HL7-to-linelist-Gonorrhoea.html">HL7-to-linelist-Gonorrhoea</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header">
<img src="logo.png" class="logo" alt=""><h1 id="hl7r-">HL7.R <a class="anchor" aria-label="anchor" href="#hl7r-"></a>
</h1>
</div>
<!-- badges: start -->

<p>The goal of HL7.R is to enable wrangling of HL7 2.3.1/2.4 in R. This package was driven by the need of HL7 wrangling for NCIMS tasks (a notifiable conditions database for a state health authority). HL7 messages are just flattened list objects, and as such can be imported into R as a nested list.</p>
<p>Information on HL7 specifications were sourced from:</p>
<ul>
<li><a href="http://www.hl7.eu/HL7v2x/v231/hl7v231segm.htm" class="external-link uri">http://www.hl7.eu/HL7v2x/v231/hl7v231segm.htm</a></li>
<li><a href="https://hl7-definition.caristix.com/v2/" class="external-link uri">https://hl7-definition.caristix.com/v2/</a></li>
</ul>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<div class="section level3">
<h3 id="devops">Devops<a class="anchor" aria-label="anchor" href="#devops"></a>
</h3>
<p>Clone repo, open <code>HL7.R.Rproj</code> and use <code>devtools</code></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/" class="external-link">devtools</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: usethis</span></span>
<span><span class="fu">load_all</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; ℹ Loading HL7.R</span></span>
<span><span class="co">#&gt; HL7.R - for help see vignette('Getting-started', package = 'HL7.R') or vignette('package = 'HL7.R') for other examples</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="from-archive">From archive<a class="anchor" aria-label="anchor" href="#from-archive"></a>
</h3>
<p>Someone built the package and has given you the file - be aware if they built using source or binary. Generally, <code>tar.gz</code> = source, <code>zip</code> = binary</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">'HL7.R.xxx.tar.gz'</span>, repos <span class="op">=</span> <span class="cn">NULL</span>, type <span class="op">=</span> <span class="st">'source'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">'HL7.R.xxx.zip'</span>, repos <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="from-drat">From DRAT<a class="anchor" aria-label="anchor" href="#from-drat"></a>
</h3>
<p>A local package repo may exist. Again, be aware if they built using source or binary. Look for <code>./bin</code> and <code>./src</code> in the DRAT folder.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/eddelbuettel/drat" class="external-link">drat</a></span><span class="op">)</span></span>
<span><span class="fu">drat</span><span class="fu">::</span><span class="fu">addRepo</span><span class="op">(</span><span class="st">"workgroup"</span>, <span class="st">'file:drive:/path/to/drat'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">'HL7.R'</span>, repos <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">repos</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="co"># assuming binary</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="parsing-a-hl7">Parsing a HL7<a class="anchor" aria-label="anchor" href="#parsing-a-hl7"></a>
</h2>
<p>The first problem this package solves is parsing of HL7 messages into a nested list. The function <code><a href="reference/parse_hl7_message.html">parse_hl7_message()</a></code> will parse a HL7 file into a list. This works for both single messages and batch messages. For each parsed message, the function will try it’s best at naming all the elements. This is simple for the top level elements (HL7 segments), but a bit more cumbersome within the list elements (HL7 segment fields). By convention, fields are referenced by number (“The fourth field in MSH is the sending facility”), but having names can make things a bit more readable at times. Repeated segments within a message are numbered in the output list e.g. OBX.1 OBX.2 (using the Set ID value).</p>
<p><strong>Notes</strong></p>
<ul>
<li>All values should be imported as text, and any conversion needs to be done downstream e.g with datetimes</li>
<li>A <code>filename</code> attribute is attached with the list object</li>
</ul>
<div class="section level3">
<h3 id="single-hl7-message">Single HL7 message<a class="anchor" aria-label="anchor" href="#single-hl7-message"></a>
</h3>
<p>Use <code><a href="reference/parse_hl7_message.html">parse_hl7_message()</a></code> on a file path.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hl7_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package <span class="op">=</span> <span class="st">'HL7.R'</span>, <span class="st">'extdata/hl7-2.3.1.hl7'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hl7_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/parse_hl7_message.html">parse_hl7_message</a></span><span class="op">(</span><span class="va">hl7_file</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">hl7_list</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "MSH"   "PID"   "PV1"   "OBR"   "OBX.1" "OBX.2" "OBX.3" "OBX.4"</span></span>
<span></span>
<span><span class="co"># First 5 fields of these segments</span></span>
<span><span class="va">hl7_list</span><span class="op">$</span><span class="va">MSH</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span>
<span><span class="co">#&gt; $EncodingCharacters</span></span>
<span><span class="co">#&gt; [1] "^~\\&amp;"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $SendingApplication</span></span>
<span><span class="co">#&gt; [1] "22-70047081"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $SendingFacility</span></span>
<span><span class="co">#&gt; [1] "AN EXAMPLE LAB"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $ReceivingApplication</span></span>
<span><span class="co">#&gt; [1] "NDD"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $ReceivingFacility</span></span>
<span><span class="co">#&gt; [1] "NSW HEALTH"</span></span>
<span><span class="va">hl7_list</span><span class="op">$</span><span class="va">PID</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span>
<span><span class="co">#&gt; $SetID</span></span>
<span><span class="co">#&gt; [1] ""</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $PatientID</span></span>
<span><span class="co">#&gt; [1] ""</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $PatientIdentifierList</span></span>
<span><span class="co">#&gt; [1] "AN EXAMPLE LAB"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $AlternatePatientIDPID</span></span>
<span><span class="co">#&gt; [1] ""</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $PatientName</span></span>
<span><span class="co">#&gt; $PatientName$familyName</span></span>
<span><span class="co">#&gt; [1] "SIMPSON"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $PatientName$givenName</span></span>
<span><span class="co">#&gt; [1] "HOMER"</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># File from where data parsed</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">hl7_list</span>, <span class="st">'filename'</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "hl7-2.3.1.hl7"</span></span></code></pre></div>
<p>Traditionally indexes are used, but using named elements can help readability.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">hl7_list</span>,</span>
<span>     <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>       first_name <span class="op">=</span> <span class="va">PID</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>,</span>
<span>       last_name <span class="op">=</span> <span class="va">PID</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span>
<span>       suburb <span class="op">=</span> <span class="va">PID</span><span class="op">[[</span><span class="fl">11</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span></span>
<span>     <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;   first_name last_name      suburb</span></span>
<span><span class="co">#&gt; 1      HOMER   SIMPSON SPRINGFIELD</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">hl7_list</span>,</span>
<span>     <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>       first_name <span class="op">=</span> <span class="va">PID</span><span class="op">$</span><span class="va">PatientName</span><span class="op">$</span><span class="va">givenName</span>,</span>
<span>       last_name <span class="op">=</span> <span class="va">PID</span><span class="op">$</span><span class="va">PatientName</span><span class="op">$</span><span class="va">familyName</span>,</span>
<span>       suburb <span class="op">=</span> <span class="va">PID</span><span class="op">$</span><span class="va">PatientAddress</span><span class="op">$</span><span class="va">city</span></span>
<span>     <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;   first_name last_name      suburb</span></span>
<span><span class="co">#&gt; 1      HOMER   SIMPSON SPRINGFIELD</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="batch-hl7-message">Batch HL7 message<a class="anchor" aria-label="anchor" href="#batch-hl7-message"></a>
</h3>
<p><code><a href="reference/parse_hl7_message.html">parse_hl7_message()</a></code> will check for batch headers and parse appropriately. The result is a list of parsed messages.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hl7_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package <span class="op">=</span> <span class="st">'HL7.R'</span>, <span class="st">'extdata/fake-covid-batch.hl7'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hl7_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/parse_hl7_message.html">parse_hl7_message</a></span><span class="op">(</span><span class="va">hl7_file</span><span class="op">)</span></span>
<span><span class="co">#&gt; Found 2 messages within file</span></span>
<span></span>
<span><span class="co"># unnamed list of length of the number of messages</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">hl7_list</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">hl7_list</span><span class="op">)</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span></span>
<span><span class="co"># a single message lives within the list elements now</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">hl7_list</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "MSH"   "PID"   "OBX.1"</span></span>
<span></span>
<span><span class="co"># accessing things</span></span>
<span><span class="va">hl7_list</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">PID</span><span class="op">$</span><span class="va">PatientName</span></span>
<span><span class="co">#&gt; $familyName</span></span>
<span><span class="co">#&gt; [1] "Homer"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $givenName</span></span>
<span><span class="co">#&gt; [1] "Simpson"</span></span>
<span><span class="va">hl7_list</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">PID</span><span class="op">$</span><span class="va">PatientName</span></span>
<span><span class="co">#&gt; $familyName</span></span>
<span><span class="co">#&gt; [1] "Ned"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $givenName</span></span>
<span><span class="co">#&gt; [1] "Flanders"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="multiple-hl7-to-line-list">Multiple HL7 to line list<a class="anchor" aria-label="anchor" href="#multiple-hl7-to-line-list"></a>
</h3>
<p>Cycle through each file and use <code><a href="reference/parse_hl7_message.html">parse_hl7_message()</a></code></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Two HL7 files starting with 'fake' are distributed with this package, </span></span>
<span><span class="va">hl7_files</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package <span class="op">=</span> <span class="st">'HL7.R'</span>, <span class="st">'extdata'</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">'fake-covid-\\d.hl7$'</span>, full.names <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">basename</a></span><span class="op">(</span><span class="va">hl7_files</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "fake-covid-1.hl7" "fake-covid-2.hl7"</span></span>
<span></span>
<span><span class="co"># Parse into list</span></span>
<span><span class="va">hl7_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">hl7_files</span>, <span class="va">parse_hl7_message</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">hl7_list</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 2</span></span>
<span></span>
<span><span class="co"># Equivalent result to a parsed batch HL7</span></span>
<span><span class="va">hl7_list</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">PID</span><span class="op">$</span><span class="va">PatientName</span></span>
<span><span class="co">#&gt; $familyName</span></span>
<span><span class="co">#&gt; [1] "Homer"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $givenName</span></span>
<span><span class="co">#&gt; [1] "Simpson"</span></span>
<span><span class="va">hl7_list</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">PID</span><span class="op">$</span><span class="va">PatientName</span></span>
<span><span class="co">#&gt; $familyName</span></span>
<span><span class="co">#&gt; [1] "Ned"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $givenName</span></span>
<span><span class="co">#&gt; [1] "Flanders"</span></span>
<span></span>
<span><span class="co"># el = list element in each loop</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">hl7_list</span>, <span class="kw">function</span><span class="op">(</span><span class="va">el</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">el</span>,</span>
<span>       <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>         first_name <span class="op">=</span> <span class="va">PID</span><span class="op">$</span><span class="va">PatientName</span><span class="op">$</span><span class="va">givenName</span>,</span>
<span>         last_name <span class="op">=</span> <span class="va">PID</span><span class="op">$</span><span class="va">PatientName</span><span class="op">$</span><span class="va">familyName</span>,</span>
<span>         suburb <span class="op">=</span> <span class="va">PID</span><span class="op">$</span><span class="va">PatientAddress</span><span class="op">$</span><span class="va">city</span>,</span>
<span>         lab <span class="op">=</span> <span class="va">MSH</span><span class="op">$</span><span class="va">SendingFacility</span>,</span>
<span>         test <span class="op">=</span> <span class="va">OBX.1</span><span class="op">$</span><span class="va">ObservationIdentifier</span><span class="op">$</span><span class="va">text</span>,</span>
<span>         result <span class="op">=</span> <span class="va">OBX.1</span><span class="op">$</span><span class="va">ObservationValue</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span>       <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind.data.frame</span>, <span class="va">.</span><span class="op">)</span></span>
<span><span class="co">#&gt;   first_name last_name      suburb                     lab          test   result</span></span>
<span><span class="co">#&gt; 1    Simpson     Homer Springfield      Dr Hibbert Medical nCoV-2019 PCR  Postive</span></span>
<span><span class="co">#&gt; 2   Flanders       Ned Springfield Nick Riviera Appartment nCoV-2019 PCR Negative</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="creating-hl7-231">Creating HL7 2.3.1<a class="anchor" aria-label="anchor" href="#creating-hl7-231"></a>
</h2>
<p>The second problem this package solves is converting any arbitrary piece of data into a HL7 message. This is conducted by piecing together <strong>segments</strong> such as the message header (MSH), Patient identification (PID) and Observation/Results (OBX). This package provides segment functions e.g. <code><a href="reference/MSH.html">MSH()</a></code>, <code><a href="reference/PID.html">PID()</a></code>, with named parameters that will build a text segment ready for piecing together using the function <code><a href="reference/build_hl7.html">build_hl7()</a></code>.</p>
<p><strong>Notes</strong></p>
<ul>
<li>There a default blank values for all the fields in a segment function, and they will be included in the final output as shown below up until the last observed value i.e. trailing blanks are trimmed see the parameter <code>.trim</code> in most functions</li>
<li>There are helper functions <code>*Components()</code> for nested fields. As these are helpers, you can safely skip if you can correctly create the required value</li>
<li>Dates/Datetimes can be converted using <code><a href="reference/datetime_to_hl7_datetime.html">datetime_to_hl7_datetime()</a></code>
</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">example_hl7_build</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="reference/build_hl7.html">build_hl7</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="reference/MSH.html">MSH</a></span><span class="op">(</span>SendingFacility <span class="op">=</span> <span class="st">'A lab'</span>, ReceivingFacility <span class="op">=</span> <span class="st">'NSW Health'</span>, VersionID <span class="op">=</span> <span class="st">'2.3.1'</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="reference/PID.html">PID</a></span><span class="op">(</span>PatientID <span class="op">=</span> <span class="st">'1234'</span>, </span>
<span>        PatientName <span class="op">=</span> <span class="fu"><a href="reference/PatientNameComponents.html">PatientNameComponents</a></span><span class="op">(</span>familyName <span class="op">=</span> <span class="st">'Ross'</span>, </span>
<span>                                            givenName <span class="op">=</span> <span class="st">'Bob'</span><span class="op">)</span>, </span>
<span>        PatientAddress <span class="op">=</span> <span class="fu"><a href="reference/PatientAddressComponents.html">PatientAddressComponents</a></span><span class="op">(</span>streetAddress <span class="op">=</span> <span class="st">'123 Fake Street'</span>, </span>
<span>                                                  city <span class="op">=</span> <span class="st">'Springfield'</span>,</span>
<span>                                                  zipPostcode <span class="op">=</span> <span class="st">'90120'</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="reference/OBX.html">OBX</a></span><span class="op">(</span>SetID <span class="op">=</span> <span class="fl">1</span>,</span>
<span>        ValueType <span class="op">=</span> <span class="st">'CE'</span>,</span>
<span>        ObservationIdentifier <span class="op">=</span> <span class="fu"><a href="reference/ObservationIdentifierComponents.html">ObservationIdentifierComponents</a></span><span class="op">(</span>identifier <span class="op">=</span> <span class="st">'NSW_LOINC-376'</span>,</span>
<span>                                                                text <span class="op">=</span> <span class="st">'nCoV-2019 PCR'</span>,</span>
<span>                                                                nameOfCodingSystem <span class="op">=</span> <span class="st">'LN'</span><span class="op">)</span>,</span>
<span>        ObservationValue <span class="op">=</span> <span class="fu"><a href="reference/variedComponents.html">variedComponents</a></span><span class="op">(</span><span class="st">'260415000^Not Detected^SNOMED-CT'</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">example_hl7_build</span></span>
<span><span class="co">#&gt; MSH|^~\&amp;||A lab||NSW Health||||||2.3.1</span></span>
<span><span class="co">#&gt; PID||1234|||Ross^Bob||||||123 Fake Street^^Springfield^^90120</span></span>
<span><span class="co">#&gt; OBX|1|CE|NSW_LOINC-376^nCoV-2019 PCR^LN||260415000^Not Detected^SNOMED-CT</span></span></code></pre></div>
<p>Conversion of Date and Datetimes</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/datetime_to_hl7_datetime.html">datetime_to_hl7_datetime</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "20230110104020"</span></span></code></pre></div>
<p><code>.trim</code> will trim trailing blank fields. It is <code>TRUE</code> by default</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/MSH.html">MSH</a></span><span class="op">(</span>SendingFacility <span class="op">=</span> <span class="st">'NSW HEALTH'</span>, VersionID <span class="op">=</span> <span class="st">'2.3.1'</span><span class="op">)</span></span>
<span><span class="co">#&gt; MSH|^~\&amp;||NSW HEALTH||||||||2.3.1</span></span>
<span><span class="fu"><a href="reference/MSH.html">MSH</a></span><span class="op">(</span>SendingFacility <span class="op">=</span> <span class="st">'NSW HEALTH'</span>, VersionID <span class="op">=</span> <span class="st">'2.3.1'</span>, .trim <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; MSH|^~\&amp;||NSW HEALTH||||||||2.3.1||||||||</span></span>
<span></span>
<span><span class="fu"><a href="reference/PatientAddressComponents.html">PatientAddressComponents</a></span><span class="op">(</span>streetAddress <span class="op">=</span> <span class="st">'123 Fake Street'</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "123 Fake Street"</span></span>
<span><span class="fu"><a href="reference/PatientAddressComponents.html">PatientAddressComponents</a></span><span class="op">(</span>streetAddress <span class="op">=</span> <span class="st">'123 Fake Street'</span>, .trim <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "123 Fake Street^^^^^"</span></span></code></pre></div>
<div class="section level3">
<h3 id="line-list-to-hl7">Line list to HL7<a class="anchor" aria-label="anchor" href="#line-list-to-hl7"></a>
</h3>
<p>Often we have the task of translating a line list into HL7 messages. A simple example is show below:</p>
<ul>
<li>loop through the rows using <code>lapply</code>
</li>
<li>convert the row into a list for easy reference e.g. <code>d$firstname</code>
</li>
</ul>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># A 2 row line list with fake data is distributed with this package</span></span>
<span><span class="va">some_line_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package <span class="op">=</span> <span class="st">'HL7.R'</span>, <span class="st">'extdata/fake-covid-n2.csv'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">some_line_list</span></span>
<span><span class="co">#&gt;   firstname lastname                street      suburb test_id     text_text result_code result_text                facility</span></span>
<span><span class="co">#&gt; 1     Homer  Simpson 742 Evergreen Terrace Springfield  ncov19 nCoV-2019 PCR           P     Postive      Dr Hibbert Medical</span></span>
<span><span class="co">#&gt; 2       Ned Flanders 744 Evergreen Terrace Springfield  ncov19 nCoV-2019 PCR           N    Negative Nick Riviera Appartment</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hl7_build_list</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">some_line_list</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">row</span><span class="op">)</span><span class="op">{</span></span>
<span>    </span>
<span>    <span class="co"># d = data element (the row, as a list)</span></span>
<span>    <span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">some_line_list</span><span class="op">[</span><span class="va">row</span>,<span class="op">]</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="fu"><a href="reference/build_hl7.html">build_hl7</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="reference/MSH.html">MSH</a></span><span class="op">(</span>SendingFacility <span class="op">=</span> <span class="va">d</span><span class="op">$</span><span class="va">facility</span>, ReceivingFacility <span class="op">=</span> <span class="st">'NSW Health'</span>, VersionID <span class="op">=</span> <span class="st">'2.3.1'</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="reference/PID.html">PID</a></span><span class="op">(</span>PatientID <span class="op">=</span> <span class="st">'1'</span>, </span>
<span>          PatientName <span class="op">=</span> <span class="fu"><a href="reference/PatientNameComponents.html">PatientNameComponents</a></span><span class="op">(</span>familyName <span class="op">=</span> <span class="va">d</span><span class="op">$</span><span class="va">firstname</span>, </span>
<span>                                              givenName <span class="op">=</span> <span class="va">d</span><span class="op">$</span><span class="va">lastname</span><span class="op">)</span>, </span>
<span>          PatientAddress <span class="op">=</span> <span class="fu"><a href="reference/PatientAddressComponents.html">PatientAddressComponents</a></span><span class="op">(</span>streetAddress <span class="op">=</span> <span class="va">d</span><span class="op">$</span><span class="va">street</span>, </span>
<span>                                                    city <span class="op">=</span> <span class="va">d</span><span class="op">$</span><span class="va">suburb</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="reference/OBX.html">OBX</a></span><span class="op">(</span>SetID <span class="op">=</span> <span class="fl">1</span>,</span>
<span>          ValueType <span class="op">=</span> <span class="st">'CE'</span>,</span>
<span>          ObservationIdentifier <span class="op">=</span> <span class="fu"><a href="reference/ObservationIdentifierComponents.html">ObservationIdentifierComponents</a></span><span class="op">(</span>identifier <span class="op">=</span> <span class="va">d</span><span class="op">$</span><span class="va">test_id</span>,</span>
<span>                                                                  text <span class="op">=</span> <span class="va">d</span><span class="op">$</span><span class="va">text_text</span>,</span>
<span>                                                                  nameOfCodingSystem <span class="op">=</span> <span class="st">'LN'</span><span class="op">)</span>,</span>
<span>          ObservationValue <span class="op">=</span> <span class="fu"><a href="reference/variedComponents.html">variedComponents</a></span><span class="op">(</span><span class="va">d</span><span class="op">$</span><span class="va">result_code</span>, <span class="va">d</span><span class="op">$</span><span class="va">result_text</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hl7_build_list</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; MSH|^~\&amp;||Dr Hibbert Medical||NSW Health||||||2.3.1</span></span>
<span><span class="co">#&gt; PID||1|||Homer^Simpson||||||742 Evergreen Terrace^^Springfield</span></span>
<span><span class="co">#&gt; OBX|1|CE|ncov19^nCoV-2019 PCR^LN||P^Postive</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; MSH|^~\&amp;||Nick Riviera Appartment||NSW Health||||||2.3.1</span></span>
<span><span class="co">#&gt; PID||1|||Ned^Flanders||||||744 Evergreen Terrace^^Springfield</span></span>
<span><span class="co">#&gt; OBX|1|CE|ncov19^nCoV-2019 PCR^LN||N^Negative</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># for filenames 001, 002, etc if necessary</span></span>
<span><span class="va">n_leading_zero</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">'%%0%sd'</span>, <span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nchar</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">hl7_build_list</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Output somewhere</span></span>
<span><span class="co"># * note this was used to make fake-covid-*.hl7 used above</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">hl7_build_list</span><span class="op">)</span><span class="op">)</span><span class="op">{</span> </span>
<span>  <span class="va">i_leading_zero</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span>fmt <span class="op">=</span> <span class="va">n_leading_zero</span>, <span class="va">i</span><span class="op">)</span></span>
<span>  <span class="va">filename</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">'Some-filename-%s.hl7'</span>, <span class="va">i_leading_zero</span><span class="op">)</span></span>
<span>  <span class="va">path</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">'some/path'</span>, <span class="va">filename</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span><span class="va">hl7_build_list</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, con <span class="op">=</span> <span class="va">path</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing HL7.R</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Shaun Nielsen <br><small class="roles"> Author, maintainer </small>  </li>
<li>Alasdair King <br><small class="roles"> Author, contributor </small>  </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/Shaunson26/HL7.R/actions/workflows/r-cmd-check.yml" class="external-link"><img src="https://github.com/Shaunson26/HL7.R/actions/workflows/r-cmd-check.yml/badge.svg" alt="R-CMD-check"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Shaun Nielsen, Alasdair King.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
